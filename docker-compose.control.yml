version: '3.8'

services:
  parallax-scheduler:
    image: gradientservice/parallax:latest
    container_name: parallax-scheduler
    ports:
      - "3001:3001"
    command: parallax run -m Qwen/Qwen3-0.6GB -n 3
    network_mode: host
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  convo-mapper:
    image: ghcr.io/stanleyhello/convo-mapper:latest
    container_name: convo-mapper
    depends_on:
      - parallax-scheduler
    devices:
      - /dev/snd:/dev/snd
    environment:
      - PULSE_SERVER=unix:/run/user/1000/pulse/native
      - PARALLAX_ENDPOINT=http://localhost:3001/v1
      - SAMPLE_RATE=16000
      - MODEL_NAME=small
    volumes:
      - /run/user/1000/pulse:/run/user/1000/pulse:ro
      - ./transcript.txt:/app/transcript.txt
    ports:
      - "5000:5000"
    network_mode: host
    restart: unless-stopped
